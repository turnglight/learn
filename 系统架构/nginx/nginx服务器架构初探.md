# Nginx服务器架构初探
+ 模块化机构
+ 处理web请求
+ 事件驱动模型
+ 架构概览

## Nginx模块化结构
> 高内聚、低耦合的设计思想
+ 核心模块（文件命名规则：前缀ngx_,后缀_module）
    + 主体功能
        + 进程管理
        + 权限控制
        + 错误日志记录
        + 配置解析
    + 响应请求事件必备功能
        + 事件驱动机制
        + 正则表达式解析
+ 标准HTTP模块（文件命名规则：前缀ngx_http_）
    + HTTP服务
    + 高级HTTP服务
    + 邮件服务
+ 可选HTTP模块
+ 邮件服务模块（文件命名规则：前缀ngx_mail_）
+ 第三方模块

## Nginx服务器的web请求处理机制
+ 多进程方式
    + 多进程处理请求，互不干扰，但是资源消耗较大
+ 多线程方式
    + 开销较小，但是多线程在同一个进程下，会产生相互干扰，有意外风险
+ 异步方式
    + 同步/异步/阻塞/非阻塞
        + 网络通信模块
            + 同步机制：请求等待接收到响应后，再处理下一个请求
            + 异步机制：请求无需等待响应，处理下一个请求
        + 网络通信进程处理调用方式（SOCKET）
            + 阻塞：调用结果返回前，当前线程挂起
            + 非阻塞：调用结果不能返回前，线程也不会挂起，直接处理下一个请求
> 同步与异步、阻塞与非阻塞，它们是两种不同的概念，从而产生了4个通信方式
+ 同步阻塞
+ 同步非阻塞
+ 异步阻塞
+ 异步非阻塞
    + 接收方处理请求进行的IO操作如果不能马上得到结果，也不等待，而是去做其它的工作，当IO操作完成之后，将完成状态和结果通知接收方，接收方再进行响应

### Nginx服务如何处理请求
> 它结合多进程以及异步机制对外提供服务。异步机制使用的异步非阻塞方式。
> Nginx服务启动后，产生了一个主进程和多个工作进程，其中可以在配置文件指定产生的工作进程数量。
+ 在异步非阻塞中，IO是操作完成后，是如何将完成状态通知给工作进程的？
    + 第一种方案：让工作进程没隔一段时间就去检查IO运行状态
    + 第二种方案：IO操作完成之后，主动通知工作进程,`这是nginx的处理方式`，从而引出了时间驱动模型

## Nginx事件驱动模型
+ 事件收集器（专门收集所有事件）
+ 事件发送器（负责将收集到的事件分发到对应事件处理器）
+ 事件处理器（负责事件的具体响应工作）
## 事件处理器的三种处理方式
+ 事件发送器将事件发送给事件处理器，每一个事件处理器新建一个`进程`处理改事件（开销大）
+ 事件发送器将事件发送给事件处理器，每一个事件处理器新建一个`线程`处理改事件（死锁/同步问题）
+ 事件发送器将事件发送至待处理事件列表，使用非阻塞I/O方式调用`事件处理器`来处理请求（Nginx采用的方式，逐渐形成了事件驱动处理库）

### 事件驱动处理库
> 事件驱动处理库又被称为多路IO复用方法，最常见的包括一下三种：select模型、poll模型、和epoll模型

+ select库
+ poll库（select库的优化版）
+ epoll库（poll的变种，将事件处理列表的工作交给系统内核，有内核将状态通知至进程）

    
    






